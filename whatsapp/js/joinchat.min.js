(function(t,e,n,a){"use strict";function i(){function i(){clearTimeout(c),a.chatbox_show()}function o(){a.save_hash(),a.chatbox_hide()}function s(){g&&!a.chatbox?i():Date.now()>a.showed_at+600&&(o(),a.open_whatsapp())}t(n).trigger("joinchat:starting");var h,c,r=1e3*a.settings.button_delay,_=1e3*a.settings.message_delay,l=!!a.settings.message_hash,g=!!a.$(".joinchat__box").length,d=parseInt(a.store.getItem("joinchat_views")||1)>=a.settings.message_views,p=(a.store.getItem("joinchat_hashes")||"").split(",").filter(Boolean),u=-1!==p.indexOf(a.settings.message_hash||"none"),v="joinchat--show";if(u||l&&_&&!a.settings.message_badge&&d||(v+=" joinchat--tooltip"),setTimeout(function(){a.$div.addClass(v)},r),l&&!u&&_&&(a.settings.message_badge?c=setTimeout(function(){a.$(".joinchat__badge").addClass("joinchat__badge--in")},r+_):d&&(c=setTimeout(i,r+_))),g&&!a.is_mobile&&a.$(".joinchat__button").on("mouseenter",function(){h=setTimeout(i,1500)}).on("mouseleave",function(){clearTimeout(h)}),a.$(".joinchat__button").on("click",s),a.$(".joinchat__close").on("click",o),a.$("#joinchat_optin").on("change",function(){a.$div.toggleClass("joinchat--optout",!this.checked)}),a.$(".joinchat__box__scroll").on("mousewheel DOMMouseScroll",function(t){t.preventDefault();var e=t.originalEvent.wheelDelta||-t.originalEvent.detail;this.scrollTop+=30*(e<0?1:-1)}),a.is_mobile){var f,m;function b(){var t=(n.activeElement.type||"").toLowerCase();["date","datetime","email","month","number","password","search","tel","text","textarea","time","url","week"].indexOf(t)>=0?a.chatbox?(a.chatbox_hide(),setTimeout(function(){a.$div.removeClass("joinchat--show")},400)):a.$div.removeClass("joinchat--show"):a.$div.addClass("joinchat--show")}t(n).on("focus blur","input, textarea",function(e){t(e.target).closest(a.$div).length||(clearTimeout(f),f=setTimeout(b,200))}),t(e).on("resize",function(){clearTimeout(m),m=setTimeout(function(){a.$div[0].style.setProperty("--vh",e.innerHeight+"px")},200)}).trigger("resize")}if(t(n).on("click",'.joinchat_open, .joinchat_app, a[href="#joinchat"], a[href="#whatsapp"]',function(e){e.preventDefault(),!g||a.optin()&&!t(this).is('.joinchat_open, a[href="#joinchat"]')?a.open_whatsapp(t(this).data("phone"),t(this).data("message")):i()}),t(n).on("click",".joinchat_close",function(t){t.preventDefault(),a.chatbox_hide()}),g&&"IntersectionObserver"in e){var j=t(".joinchat_show, .joinchat_force_show");function w(e){t.each(e,function(){if(this.intersectionRatio>0&&(!u||t(this.target).hasClass("joinchat_force_show")))return i(),x.disconnect(),!1})}if(j.length>0){var x=new IntersectionObserver(w);j.each(function(){x.observe(this)})}}a.settings.qr&&a.can_qr&&!a.is_mobile?a.$(".joinchat__qr").append(a.qr(a.whatsapp_link(void 0,void 0,!1))):a.$(".joinchat__qr").remove(),g&&a.$div.css("--peak","url(#joinchat__message__peak)"),t(n).trigger("joinchat:start"),a.is_ready=!0}function o(t){return function(){t&&t.apply(this,arguments),t=null}}function s(){if(a.$div=t(".joinchat"),a.$div.length){a.settings=a.$div.data("settings");try{localStorage.setItem("test",1),localStorage.removeItem("test"),a.store=localStorage}catch(t){a.store={_data:{},setItem:function(t,e){this._data[t]=String(e)},getItem:function(t){return this._data.hasOwnProperty(t)?this._data[t]:null}}}if("object"!=typeof a.settings)try{a.settings=JSON.parse(a.$div.attr("data-settings"))}catch(t){a.settings=void 0,console.error("Joinchat: can't get settings")}if(a.settings&&a.settings.telephone&&(a.is_mobile||!a.settings.mobile_only?i():(a.$div.removeClass("joinchat--show"),t(n).on("click",'.joinchat_open, .joinchat_app, a[href="#joinchat"], a[href="#whatsapp"]',function(e){e.preventDefault(),a.open_whatsapp(t(this).data("phone"),t(this).data("message"))})),a.can_qr&&!a.is_mobile?t(".joinchat-button__qr").each(function(){t(this).append(a.qr(a.whatsapp_link(t(this).data("phone"),t(this).data("message"),!1)))}):t(".wp-block-joinchat-button figure").remove(),void 0!==a.settings.sku)){var e=a.settings.message_send;t("form.variations_form").on("found_variation reset_data",function(t,n){var i=n&&n.sku||a.settings.sku;a.$(".joinchat__box sku").text(i),a.settings.message_send=e.replace(/<sku>.*<\/sku>/g,i)})}a.store.setItem("joinchat_views",parseInt(a.store.getItem("joinchat_views")||0)+1)}}a=t.extend({$div:null,settings:null,store:null,chatbox:!1,showed_at:0,is_ready:!1,is_mobile:!!navigator.userAgent.match(/Android|iPhone|BlackBerry|IEMobile|Opera Mini/i),can_qr:"function"==typeof kjua},a),e.joinchat_obj=a,a.$=function(e){return t(e||this.$div,this.$div)},a.send_event=function(a){if(a=t.extend({event_category:"JoinChat",event_label:"",event_action:"",chat_channel:"whatsapp",chat_id:"--",is_mobile:this.is_mobile?"yes":"no",page_location:location.href,page_title:n.title||"no title"},a),a.event_label=a.event_label||a.link||"",a.event_action=a.event_action||a.chat_channel+": "+a.chat_id,delete a.link,!1!==t(n).triggerHandler("joinchat:event",[a])){var i=e[this.settings.ga_tracker]||e.ga||e.__gaTracker,o=e[this.settings.data_layer]||e[e.gtm4wp_datalayer_name]||e.dataLayer;if("function"==typeof i&&"function"==typeof i.getAll){i("set","transport","beacon");var s=i.getAll();s.forEach(function(t){t.send("event",a.event_category,a.event_action,a.event_label)})}if(t.each(a,function(t,e){a[t]="string"==typeof e?e.substring(0,100):e}),"function"==typeof gtag&&"object"==typeof o){var h=this.settings.ga_event||"generate_lead",c=t.extend({transport_type:"beacon"},a);delete c.page_location,delete c.page_title,o.forEach(function(t){"config"==t[0]&&t[1]&&"G-"==t[1].substring(0,2)&&(c.send_to=t[1],gtag("event",h,c))}),this.settings.gads&&gtag("event","conversion",{send_to:this.settings.gads})}var r=a.event_category;delete a.event_category,"object"==typeof o&&o.push(t.extend({event:r},a)),"function"==typeof fbq&&fbq("trackCustom",r,a)}},a.whatsapp_link=function(t,e,n){e=void 0!==e?e:this.settings.message_send||"",n=void 0!==n?n:this.settings.whatsapp_web&&!this.is_mobile;var a=(n?"https://web.whatsapp.com/send?phone=":"https://wa.me/")+encodeURIComponent(t||this.settings.telephone);return a+(e?(n?"&text=":"?text=")+encodeURIComponent(e):"")},a.chatbox_show=function(){this.chatbox||(this.chatbox=!0,this.showed_at=Date.now(),this.$div.addClass("joinchat--chatbox"),this.settings.message_badge&&this.$(".joinchat__badge").hasClass("joinchat__badge--in")&&this.$(".joinchat__badge").toggleClass("joinchat__badge--in joinchat__badge--out"),t(n).trigger("joinchat:show"))},a.chatbox_hide=function(){this.chatbox&&(this.chatbox=!1,this.$div.removeClass("joinchat--chatbox joinchat--tooltip"),this.settings.message_badge&&this.$(".joinchat__badge").removeClass("joinchat__badge--out"),t(n).trigger("joinchat:hide"))},a.save_hash=function(){var t=this.settings.message_hash||"none",e=(this.store.getItem("joinchat_hashes")||"").split(",").filter(Boolean);-1===e.indexOf(t)&&(e.push(t),this.store.setItem("joinchat_hashes",e.join(",")))},a.open_whatsapp=function(a,i){a=a||this.settings.telephone,i=void 0!==i?i:this.settings.message_send||"";var o={link:this.whatsapp_link(a,i),chat_channel:"whatsapp",chat_id:a,chat_message:i},s=new RegExp("^https?://(wa.me|(api|web|chat).whatsapp.com|"+location.hostname.replace(".",".")+")/.*","i");!1!==t(n).triggerHandler("joinchat:open",[o])&&(s.test(o.link)?(this.send_event(o),e.open(o.link,"joinchat","noopener")):console.error("Joinchat: the link doesn't seem safe, it must point to the current domain or whatsapp.com"))},a.optin=function(){return!this.$div.hasClass("joinchat--optout")},a.qr=function(e,n){return kjua(t.extend({text:e,render:"canvas",rounded:80},a.settings.qr||{},n||{}))};var h=o(s);t(h),t(e).on("load",h),n.addEventListener("DOMContentLoaded",h)})(jQuery,window,document,window.joinchat_obj||{});